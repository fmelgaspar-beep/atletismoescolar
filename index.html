<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Inscrição – Jogos Escolares (Atletismo)</title>
  <style>
    body { background:#0f172a; color:#e5e7eb; font-family:system-ui; margin:0; }
    .container{ max-width:900px; margin:20px auto; padding:16px; }
    .card{ background:#111827; border-radius:12px; padding:16px; margin-bottom:16px; }
    h1,h2{ margin:0 0 12px 0; }
    label{ display:block; margin:6px 0; color:#94a3b8; }
    input, select{ width:100%; padding:8px; border-radius:8px; border:1px solid #1f2937; background:#0b1020; color:#e5e7eb; }
    .row{ display:grid; grid-template-columns: repeat(auto-fit,minmax(200px,1fr)); gap:12px; }
    .btn{ padding:10px 14px; border:none; border-radius:8px; cursor:pointer; margin-top:8px; }
    .btn-primary{ background:#22d3ee; color:#021015; font-weight:700; }
    .btn-danger{ background:#fb7185; color:#160709; font-weight:700; }
    .modal{ position:fixed; top:0; left:0; width:100%; height:100%; background:rgba(0,0,0,.7); display:none; align-items:center; justify-content:center; }
    .modal-content{ background:#1e293b; padding:20px; border-radius:12px; max-width:800px; width:90%; max-height:80vh; overflow:auto; }
    table{ width:100%; border-collapse:collapse; margin-top:12px; }
    th,td{ border:1px solid #334155; padding:6px; font-size:.9rem; text-align:left; }
  </style>
</head>
<body>
  <div class="container">
    <div class="card">
      <h1>Inscrição – Atletismo Convencional • Jogos Escolares</h1>
      <p>Cada aluno: até <b>2 provas individuais</b> + <b>1 revezamento</b>.<br>
      Cada escola: até <b>2 atletas/prova/gênero</b> + <b>1 equipe de revezamento</b> (4 atletas) por categoria/gênero.</p>
    </div>

    <!-- Identificação -->
    <div class="card">
      <h2>1) Identificação da Unidade de Ensino</h2>
      <div class="row">
        <div>
          <label>Unidade de Ensino</label>
          <select id="schools" required></select>
        </div>
        <div>
          <label>Professor Responsável</label>
          <input id="teacher" type="text" required />
        </div>
        <div>
          <label>Email</label>
          <input id="email" type="email" required />
        </div>
        <div>
          <label>Telefone</label>
          <input id="phone" type="tel" required />
        </div>
      </div>
    </div>

    <!-- Alunos -->
    <div class="card">
      <h2>2) Inscrição de Alunos</h2>
      <div id="students"></div>
      <button class="btn btn-primary" id="addStudentBtn" type="button">+ Adicionar aluno</button>
    </div>

    <div class="card">
      <button class="btn btn-primary" id="reviewBtn" type="button">Revisar inscrição</button>
    </div>
  </div>

  <!-- Modal revisão -->
  <div class="modal" id="reviewModal">
    <div class="modal-content">
      <h2>Revisão da Inscrição</h2>
      <div id="reviewContent"></div>
      <div style="margin-top:12px; text-align:right;">
        <button class="btn btn-danger" id="cancelReview">Cancelar</button>
        <button class="btn btn-primary" id="confirmReview">Confirmar e Enviar</button>
      </div>
    </div>
  </div>

  <!-- Template aluno -->
  <template id="studentTemplate">
    <div class="card student">
      <div class="row">
        <div><label>Nome</label><input type="text" class="inp-name" required></div>
        <div><label>Data de Nascimento</label><input type="date" class="inp-dob" required></div>
        <div><label>Documento</label><input type="text" class="inp-doc" required></div>
        <div>
          <label>Gênero</label>
          <select class="sel-gender" required>
            <option value="">Selecione…</option>
            <option value="MASCULINO">Masculino</option>
            <option value="FEMININO">Feminino</option>
          </select>
        </div>
        <div>
          <label>Categoria</label>
          <select class="sel-category" required></select>
        </div>
      </div>
      <div class="row">
        <div><label>Prova 1</label><select class="sel-event1"></select></div>
        <div><label>Prova 2</label><select class="sel-event2"></select></div>
        <div><label>Revezamento</label><select class="sel-relay"></select></div>
      </div>
      <button class="btn btn-danger btnRemove" type="button">Remover</button>
    </div>
  </template>

  <script>
    // ✅ Atualizado com sua URL
    const SCRIPT_URL = "https://script.google.com/macros/s/AKfycbwe9Gpt4gDZu6BhsE5o4NPHikA4Y5yQCAbuX_p90e5woe3nkDDdWgUkod2gzrZ1th29dA/exec";

    // === Configurações ===
    const SCHOOLS = {
      "COLÉGIO MADRE FRANCISCA LAMPEL": ["MIRIM MASCULINO","MIRIM FEMININO","INFANTIL MASCULINO","INFANTIL FEMININO","INFANTO MASCULINO"],
      "COLÉGIO UNI": ["MIRIM MASCULINO","MIRIM FEMININO","INFANTIL MASCULINO","INFANTIL FEMININO","INFANTO MASCULINO","INFANTO FEMININO"],
      "EEB DOLORES L. S. KRAUSS": ["MIRIM MASCULINO","MIRIM FEMININO","INFANTIL MASCULINO","INFANTIL FEMININO"],
      "EEB FERANDINO DAGNONI": ["MIRIM MASCULINO","MIRIM FEMININO","INFANTIL MASCULINO","INFANTIL FEMININO"],
      "EEB FREI GODOFREDO": ["MIRIM MASCULINO","MIRIM FEMININO","INFANTIL MASCULINO","INFANTIL FEMININO","INFANTO MASCULINO","INFANTO FEMININO"],
      "EEB FREI POLICARPO": ["MIRIM MASCULINO","MIRIM FEMININO","INFANTIL MASCULINO","INFANTIL FEMININO","INFANTO MASCULINO","INFANTO FEMININO"],
      "EEB HONÓRIO MIRANDA": ["INFANTIL MASCULINO","INFANTO MASCULINO"],
      "EEB IVO D´ÁQUINO": ["MIRIM MASCULINO","MIRIM FEMININO","INFANTIL MASCULINO","INFANTIL FEMININO"],
      "EEB LUIZ FRANZÓI": ["MIRIM MASCULINO","MIRIM FEMININO","INFANTIL MASCULINO","INFANTIL FEMININO"],
      "EEB MARINA VIEIRA LEAL": ["MIRIM MASCULINO","MIRIM FEMININO","INFANTIL MASCULINO","INFANTIL FEMININO","INFANTO MASCULINO","INFANTO FEMININO"],
      "EEB NORMA MÔNICA SABEL": ["MIRIM MASCULINO","MIRIM FEMININO","INFANTIL MASCULINO","INFANTIL FEMININO"],
      "EEB PROF OLÍMPIO MORETTO": ["MIRIM MASCULINO","MIRIM FEMININO","INFANTIL MASCULINO","INFANTIL FEMININO"],
      "FSC - INSTITUTO FEDERAL DE SC": ["INFANTO MASCULINO","INFANTO FEMININO"]
    };

    const $ = (s,r=document)=>r.querySelector(s);
    const $$ = (s,r=document)=>[...r.querySelectorAll(s)];

    const schoolSel=$("#school");
    Object.keys(SCHOOLS).forEach(s=>{
      let opt=document.createElement("option");
      opt.value=s; opt.textContent=s; schoolSel.appendChild(opt);
    });

    const studentTpl=$("#studentTemplate");

    $("#addStudentBtn").onclick=()=>addStudent();
    function addStudent(){
      let node=studentTpl.content.firstElementChild.cloneNode(true);
      $(".btnRemove",node).onclick=()=>node.remove();
      $("#students").appendChild(node);
    }

    // Revisão
    $("#reviewBtn").onclick=()=>{
      const data=collectData();
      if(!data) return;
      showReview(data);
    };

    $("#cancelReview").onclick=()=>$("#reviewModal").style.display="none";
    $("#confirmReview").onclick=()=>{
      const data=collectData();
      fetch(SCRIPT_URL,{
        method:"POST",
        body:JSON.stringify(data),
        headers:{"Content-Type":"application/json"}
      }).then(r=>r.json()).then(res=>{
        $("#reviewModal").style.display="none";
        if(res.result==="success"){ alert("Inscrição confirmada! Um extrato foi enviado para o e-mail informado."); location.reload(); }
        else alert("Erro: "+res.error);
      });
    };

    function collectData(){
      const school=schoolSel.value;
      if(!school){alert("Selecione a escola");return null;}
      const teacher=$("#teacher").value, email=$("#email").value, phone=$("#phone").value;
      let students=[];
      let valid=true;
      $$(".student").forEach(card=>{
        let st={
          name:$(".inp-name",card).value,
          dob:$(".inp-dob",card).value,
          doc:$(".inp-doc",card).value,
          gender:$(".sel-gender",card).value,
          category:$(".sel-category",card).value,
          prova1:$(".sel-event1",card).value,
          prova2:$(".sel-event2",card).value,
          relay:$(".sel-relay",card).value
        };
        if(!st.name||!st.dob||!st.doc||!st.gender||!st.category) valid=false;
        students.push(st);
      });
      if(!valid){alert("Preencha todos os campos dos alunos");return null;}
      return {school,teacher,email,phone,students};
    }

    function showReview(data){
      let html=`<p><b>Escola:</b> ${data.school}<br>
      <b>Professor:</b> ${data.teacher}<br>
      <b>Email:</b> ${data.email}<br>
      <b>Telefone:</b> ${data.phone}</p>`;
      html+=`<table><thead><tr><th>Nome</th><th>Nascimento</th><th>Doc</th><th>Gênero</th><th>Categoria</th><th>Prova 1</th><th>Prova 2</th><th>Revezamento</th></tr></thead><tbody>`;
      data.students.forEach(s=>{
        html+=`<tr><td>${s.name}</td><td>${s.dob}</td><td>${s.doc}</td><td>${s.gender}</td><td>${s.category}</td><td>${s.prova1}</td><td>${s.prova2}</td><td>${s.relay}</td></tr>`;
      });
      html+="</tbody></table>";
      $("#reviewContent").innerHTML=html;
      $("#reviewModal").style.display="flex";
    }
  </script>
</body>
</html>
