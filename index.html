<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <title>Formulário de Inscrição</title>
  <style>
    body { font-family: Arial, sans-serif; margin: 20px; }
    fieldset { margin-bottom: 20px; padding: 15px; border-radius: 8px; }
    legend { font-weight: bold; }
    label { display: block; margin-top: 10px; }
    select, input { padding: 5px; width: 100%; margin-top: 5px; }
    button { padding: 10px 15px; margin-top: 15px; cursor: pointer; }
    .extrato { margin-top: 30px; padding: 15px; border: 1px solid #ccc; border-radius: 8px; }
  </style>
</head>
<body>

  <h2>Inscrição de Unidade de Ensino</h2>

  <!-- Identificação da Unidade -->
  <fieldset>
    <legend>Identificação da Unidade de Ensino</legend>
    <label>Nome da Unidade: <input type="text" id="unidadeEnsino" required></label>
    <label>Nome do Professor Responsável: <input type="text" id="professor" required></label>
    <label>Email de contato: <input type="email" id="email" required></label>
    <label>Telefone: <input type="tel" id="telefone" required></label>
  </fieldset>

  <!-- Cadastro de Aluno -->
  <fieldset>
    <legend>Dados do Aluno</legend>
    <label>Nome do Aluno: <input type="text" id="alunoNome"></label>
    <label>Ano de Nascimento:
      <input type="number" id="anoNascimento" min="2005" max="2015">
    </label>
    <label>Gênero:
      <select id="genero">
        <option value="">Selecione</option>
        <option value="M">Masculino</option>
        <option value="F">Feminino</option>
      </select>
    </label>
    <label>Categoria:
      <select id="categoria" disabled>
        <option value="">Selecione o ano de nascimento</option>
      </select>
    </label>

    <label>Prova 1:
      <select id="prova1" disabled>
        <option value="">Selecione a prova</option>
      </select>
    </label>

    <label>Prova 2:
      <select id="prova2" disabled>
        <option value="">Selecione a prova</option>
      </select>
    </label>

    <label>Prova 3 (Revezamento):
      <select id="provaRevezamento" disabled>
        <option value="">Selecione o revezamento</option>
      </select>
    </label>

    <button type="button" onclick="adicionarAluno()">Adicionar Aluno</button>
  </fieldset>

  <!-- Finalizar -->
  <button type="button" onclick="finalizarInscricao()">Finalizar Inscrição</button>

  <!-- Extrato -->
  <div id="extrato" class="extrato" style="display:none;"></div>

  <script>
    const provasIndividuais = {
      "Mirim": ["100m", "200m", "Arremesso de Peso"],
      "Infantil": ["100m", "200m", "Salto em Distância", "Arremesso de Peso"],
      "Infanto": ["100m", "200m", "400m", "Salto em Altura", "Lançamento de Dardo"]
    };

    const provasRevezamento = {
      "Mirim": ["Revezamento 4x50m"],
      "Infantil": ["Revezamento 4x75m"],
      "Infanto": ["Revezamento 4x100m"]
    };

    const limites = { individual: 2, revezamento: 4 };

    let inscritos = [];
    let controleProvas = {}; // controla qtd por prova/gênero

    function atualizarCategoria() {
      const ano = parseInt(document.getElementById("anoNascimento").value);
      const categoria = document.getElementById("categoria");
      categoria.innerHTML = "<option value=''>Selecione</option>";

      let cat = "";
      if (ano >= 2012 && ano <= 2015) cat = "Mirim";
      else if (ano >= 2010 && ano <= 2012) cat = "Infantil";
      else if (ano >= 2008 && ano <= 2010) cat = "Infanto";

      if (cat) {
        categoria.innerHTML += `<option value="${cat}" selected>${cat}</option>`;
        carregarProvas(cat);
      }
    }

    function carregarProvas(categoria) {
      const prova1 = document.getElementById("prova1");
      const prova2 = document.getElementById("prova2");
      const provaRev = document.getElementById("provaRevezamento");

      prova1.disabled = prova2.disabled = provaRev.disabled = false;

      prova1.innerHTML = "<option value=''>Selecione</option>";
      provasIndividuais[categoria].forEach(p => prova1.innerHTML += `<option value="${p}">${p}</option>`);

      prova2.innerHTML = "<option value=''>Selecione</option>";
      provasIndividuais[categoria].forEach(p => prova2.innerHTML += `<option value="${p}">${p}</option>`);

      provaRev.innerHTML = "<option value=''>Selecione</option>";
      provasRevezamento[categoria].forEach(p => provaRev.innerHTML += `<option value="${p}">${p}</option>`);

      prova1.onchange = () => {
        prova2.innerHTML = "<option value=''>Selecione</option>";
        provasIndividuais[categoria].forEach(p => {
          if (p !== prova1.value) prova2.innerHTML += `<option value="${p}">${p}</option>`;
        });
      };
    }

    function adicionarAluno() {
      const nome = document.getElementById("alunoNome").value;
      const ano = document.getElementById("anoNascimento").value;
      const genero = document.getElementById("genero").value;
      const categoria = document.getElementById("categoria").value;
      const prova1 = document.getElementById("prova1").value;
      const prova2 = document.getElementById("prova2").value;
      const provaRev = document.getElementById("provaRevezamento").value;

      if (!nome || !ano || !genero || !categoria) {
        alert("Preencha todos os dados do aluno.");
        return;
      }

      if (!prova1 && !prova2 && !provaRev) {
        alert("O aluno deve ser inscrito em pelo menos uma prova.");
        return;
      }

      const provasSelecionadas = [prova1, prova2, provaRev].filter(Boolean);

      // Validação de limite
      for (let prova of provasSelecionadas) {
        const chave = `${prova}_${genero}`;
        const limite = prova.includes("Revezamento") ? limites.revezamento : limites.individual;
        if (!controleProvas[chave]) controleProvas[chave] = 0;
        if (controleProvas[chave] >= limite) {
          alert(`Limite atingido para ${prova} (${genero}).`);
          return;
        }
      }

      // Registrar atleta
      inscritos.push({ nome, ano, genero, categoria, provas: provasSelecionadas });

      // Atualizar controle
      provasSelecionadas.forEach(prova => {
        const chave = `${prova}_${genero}`;
        controleProvas[chave]++;
      });

      alert("Aluno adicionado com sucesso!");
      document.getElementById("alunoNome").value = "";
      document.getElementById("anoNascimento").value = "";
      document.getElementById("genero").value = "";
      document.getElementById("categoria").innerHTML = "<option value=''>Selecione o ano de nascimento</option>";
      document.getElementById("prova1").innerHTML = "<option value=''>Selecione</option>";
      document.getElementById("prova2").innerHTML = "<option value=''>Selecione</option>";
      document.getElementById("provaRevezamento").innerHTML = "<option value=''>Selecione</option>";
    }

    function finalizarInscricao() {
      if (inscritos.length === 0) {
        alert("Nenhum aluno foi inscrito.");
        return;
      }

      const unidade = document.getElementById("unidadeEnsino").value;
      const professor = document.getElementById("professor").value;
      const email = document.getElementById("email").value;
      const telefone = document.getElementById("telefone").value;

      const dados = { unidade, professor, email, telefone, inscritos };

      // Exibir extrato
      let resumo = `<h3>Extrato da Unidade: ${unidade}</h3>`;
      resumo += `<p><b>Professor:</b> ${professor} | <b>Email:</b> ${email} | <b>Telefone:</b> ${telefone}</p>`;
      resumo += "<ul>";
      inscritos.forEach(a => {
        resumo += `<li><b>${a.nome}</b> (${a.genero}, ${a.categoria}) - Provas: ${a.provas.join(", ")}</li>`;
      });
      resumo += "</ul>";

      document.getElementById("extrato").innerHTML = resumo;
      document.getElementById("extrato").style.display = "block";

      // Enviar para Google Sheets
      fetch('https://script.google.com/macros/s/AKfycbxy-MnPU9PoIYsTkVp5Avvb8RcUSgAJMzTSgJ_kxBGG380XGE-ZVEQyOBrBqBVYUCEkRw/exec', {
        method: 'POST',
        body: JSON.stringify(dados)
      })
      .then(res => res.text())
      .then(msg => console.log("Sucesso:", msg))
      .catch(err => console.error("Erro:", err));
    }

    document.getElementById("anoNascimento").addEventListener("change", atualizarCategoria);
  </script>
</body>
</html>
